# エリオット波動EA 最適化ノート

## 実施日: 2025-11-09

## 主要な問題点の特定

### 1. Wave 2検証の問題
**問題**:
- リトレースメント範囲内であれば即確定していた
- 価格が反転したかの確認が不足
- Wave 1開始価格を超えた場合の無効化処理がなかった

**解決策**:
- 前回の足と比較して反転を確認
- Wave 1の領域を超えた場合、Wave 1自体を無効化
- デバッグモードをfalseに設定して本番運用向けに最適化

### 2. Wave 3エントリー条件の問題
**問題**:
- Wave 3が確定する前にエントリーしていた
- 最小波動サイズのチェックが不十分
- 市場環境フィルターがエントリー直前でしか適用されない

**解決策**:
- Wave 3の初期段階を検出後、一定の価格進展を確認
- Wave 3が Wave 1の少なくとも100%以上の長さになることを確認
- 早期の市場環境チェックを追加

### 3. SL/TP計算の一貫性の問題
**問題**:
- 複数の関数で異なるSL計算ロジックが存在
- ValidateSLTP()で調整された値が予期しない動作を引き起こす
- ATRベースと固定値が混在

**解決策**:
- SL計算を一本化（ATR優先、フォールバックは固定値）
- Wave 2/4の終値を基準にしたSL設定
- 最小距離チェックを強化

### 4. 市場環境フィルターの統合問題
**問題**:
- ADX、ATR、セッション時間のチェックがエントリー直前のみ
- 波動検出時にも環境を考慮すべき

**解決策**:
- Wave 1/2検出時にも市場環境をチェック
- 不適切な環境では波動カウントを開始しない
- フィルター結果をログに記録

### 5. デバッグログの過剰出力
**問題**:
- 本番運用時にも大量のログが出力される
- パフォーマンスへの影響

**解決策**:
- 各関数にdebugModeフラグを追加
- デフォルトはfalse（本番運用向け）
- 重要なイベント（Wave確定、エントリーなど）のみログ出力

## 最適化後の期待される改善

### トレード精度の向上
- Wave 2の偽シグナル削減: **約30-40%削減見込み**
- Wave 3エントリーの信頼性向上: **勝率5-10%向上見込み**

### リスク管理の強化
- SL/TP計算の一貫性: **予期しない損失を防止**
- 動的ポジションサイジング: **ボラティリティに応じた適切なロット**

### パフォーマンス向上
- ログ出力の削減: **CPU使用率10-15%削減見込み**
- 不要な計算の削減: **メモリ使用量5-10%削減見込み**

## 重要なパラメータ推奨値

### リスク管理
```
RiskPercentAligned = 0.01 (1%)
RiskPercentUnaligned = 0.005 (0.5%)
RiskRewardRatio = 3.0
```

### SL/TP設定（Micro口座）
```
MinSLDistance = 0.300 (30 pips)
MaxSLDistance = 0.600 (60 pips)
UseATRForSL = true
ATRMultiplier = 1.5
ATRPeriod = 14
```

### 市場環境フィルター
```
UseMarketEnvironmentFilter = true
MinADXForTrend = 25.0
MaxATRPercentage = 2.0
FilterBySessionTime = true
PreferredSessionHour = 13 (NY時間)
```

### 動的ポジションサイジング
```
UseDynamicPositionSizing = true
BaseRiskPercentage = 0.02 (2%)
NormalATRPercentage = 1.0
MinDynamicLotSize = 0.01
MaxDynamicLotSize = 2.0
VolatilityAdjustmentFactor = 1.0
```

## テスト推奨事項

### バックテスト設定
- 期間: 最低6ヶ月（できれば1年以上）
- 通貨ペア: USDJPY, EURJPY, GBPJPY
- タイムフレーム: H4足監視、M5足実行
- スプレッド: 実際の環境に合わせる（Micro口座は通常2-5 pips）

### フォワードテスト
1. デモ口座で最低1ヶ月
2. 少額リアル口座で1-2ヶ月
3. 本番運用へ段階的に移行

### モニタリングポイント
- 勝率の推移
- 平均利益/損失比
- 最大ドローダウン
- Wave検出精度（誤検出率）
- エントリー頻度（過剰トレード防止）

## 今後の改善案

### 短期（1-2ヶ月）
1. Wave 4検出ロジックの追加
2. Wave 5エントリー機能の実装
3. トレーリングストップの最適化

### 中期（3-6ヶ月）
1. マルチペア対応の完全実装
2. 機械学習モデルの精度向上
3. 相関関係フィルターの追加

### 長期（6ヶ月以上）
1. ディープラーニングモデルの統合
2. センチメント分析の導入
3. 自動パラメータ最適化システム

## 注意事項

⚠️ **重要**: 本番運用前に必ず十分なバックテストとフォワードテストを実施してください。

⚠️ **リスク**: エリオット波動は解釈が分かれる手法であり、100%の精度は期待できません。

⚠️ **資金管理**: 必ず適切なリスク管理を行い、許容できる範囲内での運用を心がけてください。
